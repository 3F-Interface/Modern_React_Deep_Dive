# 2. 리액트 핵심 요소 깊게 살펴보기

## 2.1. JSX란?

- XML과 유사한 내장형 구문
- 페이스북에서 개발
- 자바스크립트 표준의 일부는 아님
    - 자바스크립트 엔진이나 브라우저에서 직접 실행되거나 표현되지 않음
    - 트랜스파일러로 변환이 필요

### 2.1.1. JSX의 정의

1. JSXElement
    - JSX를 구성하는 가장 기본 요소
    - HTML의 element와 비슷한 역할
    - HTML 태그와 구분짓기 위해 대문자로 시작 (표준은 아님)
2. JSXAttributes
    - JSXElement에 부여할 수 있는 속성
        - JSXSpreadAttributes - 전개 연산자와 동일
        - JSXAttribute - 속성
            - JSXAttributeKey
            - JSXAttributeValue
        - JSXElement - 다른 JSX 요소가 들어갈 수 있음 ( 잘 안쓰임 )
        - JSXFragment - `<></>`
3. JSXChildren
    - 트리구조인 JSX에서 JSXElement의 자식 값
4. JSXStrings
    - 큰따옴표 문자열 + 작은따옴표 문자열 + JSXText
        - JSXText - `{,<,>,}` 를 제외한 문자열

### 2.1.2. JSX 예제

```jsx
const Component = (
	<A>
		{"example"}
	</A>
)
```

### 2.1.3. JSX는 어떻게 자바스크립트에서 변환될까?

`@babel/plugin-transform-react-jsx` - 리액트에서 JSX를 변환하는 플러그인

JSX

```jsx
const ComponentA = <A required={true}>Hello</A>

const ComponentB = <>Hello</>

const ComponentC = (
	<div>
		<p>Hello</p>
	</div>
)
```

JS

```jsx
'use strict'

var ComponentA = React.createElement(A, { required: true }, 'Hello')
var ComponentB = React.createElement(React.Fragment, null, 'Hello')
var ComponentC = React.createElement('div', null,
	React.createElement('p', null, 'Hello'))
```

## 2.2. 가상 DOM과 리액트 파이버

### 2.2.1. DOM과 브라우저 렌더링 과정

1. 사용자가 요청한 주소를 방문해 HTML 파일 다운로드
2. 브라우저 렌더링 엔진이 HTML 파싱 이후 DOM 트리 생성
3. 2번 과정 중 CSS 파일을 만나면 해당 파일 다운로드
4. CSSOM 트리 생성
5. 2번의 DOM 노드를 순회. 이 때 사용자 화면에 보이는 요소만 방문
6. 5번 과정 중 눈에 보이는 노드에 대한 CSS 정보를 CSSOM에서 찾아 적용
    1. 레이아웃(layout, reflow) - 브라우저 화면의 어느 좌표에 나타나야 하는지 계산하는 과정
    2. 페인팅(painting) - 레이아웃 단계를 거친 노드에 색과 같은 실제 유효한 모습을 그리는 과정

### DOM이란?

- Document Object Model
- 웹페이지에 대한 인터페이스
- 브라우저가 웹페이지의 콘텐츠와 구조를 어떻게 보여줄지에 대한 정보

### 2.2.2. 가상 DOM의 탄생 배경

전통적인 방식의 웹에서, 변화된 방식인 싱글 페이지 애플리케이션에서는 reflow와 repaint가 자주 발생하기 때문에 보다 효율적으로 화면을 그릴 필요가 있음

가상 DOM은 일반적인 DOM을 관리하는 브라우저보다 빠르다 알려져 있지만, 이는 사실이 아니다.

하지만, 대부분의 상황에서 웬만한 애플리케이션을 만들 수 있을 정도로 충분히 빠르다.

### 2.2.3. 가상 DOM을 위한 아키텍처, 리액트 파이버

가상 DOM과 렌더링 과정 최적화를 가능하게 해주는 것

### 리액트 파이버란?

- 리액트에서 관리하는 평범한 자바스크립트 객체
- 파이버 재조정자(fiber reconciler)
    - 가상 DOM과 실제 DOM을 비교해 변경 사항을 수집해, 차이가 있으면 변경에 관련된 정보를 가지고 있는 파이버를 기준으로 화면에 렌더링을 요청
- 파이버의 목표는 리액트 웹 애플리케이션에서 발생하는 애니메이션, 레이아웃, 이넡랙션에 올바른 결과물을 만드는 반응성 문제를 해결하는 것
    - 작업을 작은 단위로 분할하고 쪼갠 다음, 우선순위를 매김
    - 이러한 작업을 일시 중지하고 다시 시작할 수 있음
    - 이전에 했던 작업을 재사용하거나 필요하지 않은 경우 폐기 가능
- 모든 과정은 비동기로 일어남 / 기존 조정 알고리즘은 스택 알고리즘으로 동기적이었음(비효율)

### 파이버는 어떻게 구현돼 있을까?

- 파이버는 하나의 작업 단위로 구성
- 리액트는 이러한 작업 단위를 하나씩 처리하고 `finishedWork()` 라는 작업으로 마무리
    - 렌더 단계에서 리액트는 사용자에게 노출되지 않는 모든 비동기 작업을 수행
    - 이 때, 파이버의 작업 우선순위를 지정하거나 중지시키거나 버리는 등의 작업을 수행
- 커밋 단계에서는 DOM에 변경 사항을 반영하기 위한 작업 `commitWork()` 실행 - 동기
- 파이버는 컴포넌트가 최초로 마운트되는 시점에 생성되어 가급적이면 재사용됨
